version: '3.8'
services:
  cale-backend:
    container_name: spring
    build:
      context: .
      dockerfile: DockerfileSpring
    image: "cale_back"
    ports:
      - "8081:8080"
      - "5555:5555"
    environment:
      - JAVA_TOOL_OPTIONS=-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5555
      - SPRING_DATASOURCE_URL=jdbc:postgresql://postgres/postgres
      - SPRING_DATASOURCE_PASSWORD=tomato
      - SPRING_DATASOURCE_USERNAME=postgres
      - SPRING_DATASOURCE_driver-class-name=org.postgresql.Driver

      - SPRING_FLYWAY_USER=postgres
      - SPRING_FLYWAY_PASSWORD=tomato
      - SPRING_FLYWAY_SCHEMAS=public
      - SPRING_FLYWAY_URL=jdbc:postgresql://postgres/postgres

      - APPLICATION_SECURITY_JWT_SECRET="Bb-?$zv8whu9su5WYr-wBp-HFwqP-Yd7WU-G-@w-5bw4$&38v@&fV^6SqP34CgHsAbK^bE-&EM6Qju@TbXWPTXdqM7_p!nY#ACgxjsbv2a3FUf%MCeNF?2T9C=Tw+6@&"
      - APPLICATION_SECURITY_JWT_TYPE="JWT"
      - APPLICATION_SECURITY_JWT_ISSUER="keypopsh"
      - APPLICATION_SECURITY_JWT_AUDIENCE="users"
      - APPLICATION_SECURITY_JWT_HEADER="Authorization"
      - APPLICATION_SECURITY_JWT_PATH="/"
      - APPLICATION_SECURITY_JWT_EXPIRETIMESECONDS=3600

  postgres:
    image: 'postgres:15.4-bookworm'
    container_name: postgres
    build:
      context: .
    ports:
      - "5433:5432"
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_DB=postgres
      - POSTGRES_PASSWORD=tomato
    volumes:
      - "db-data:/var/lib/postgresql/data"
volumes:
  db-data: